import os
from logstown import db
^L
request.redirect('/')

# Convert from a .sql file to something I can feed in via psycopg2.
fp = open(os.path.join(website.root, '..', 'logstown.sql'))
raw = []
SQL = ['']
for line in fp:
    raw.append(line)
    line = line.strip('\n')
    if line.startswith('--') or not line:
        continue
    SQL[-1] += line
    if line.endswith(';'):
        SQL.append('')

# Feed into psycopg2.
for statement in SQL:
    if not statement:
        continue
    db.execute(statement)

# Send it to the viewer.
^L
<b>Database reset.</b>
<pre>{{ ''.join(raw) }}
</pre>
