"""Accounts.

http://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta

"""
import json
import re

import aspen
from aspen import Response
from logstown import authentication


# =========================================================================== 

# Set WWW-Authenticate
# ====================
# "The 401 response MUST include a WWW-Authenticate header field (section
# 14.47) containing a challenge applicable to the requested resource."
# http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.2

response.headers.set('WWW-Authenticate', 'X-Cookie')


# JavaScript doesn't need a sign in form.
# =======================================

if request.headers.one('X-Requested-With', '') == 'XMLHttpRequest':
    raise response


# Only support GET requests.
# ==========================
# HEAD? POST?

if request.method != 'GET':
    raise Response(302, '/') # should trigger a GET, but maybe HEAD?


# =========================================================================== 
<!DOCTYPE html> 
<html>
    <head>
        <title>Sign in to Logstown</title>
        <style type="text/css">@import url("/anonymous/anonymous.css");</style>
        <script src="/anonymous/jquery-1.7.1.min.js"></script>
        <script src="/anonymous/anonymous.js"></script>
        <script>$(document).ready(Anon.main);</script>
    </head>
    <body>
        <div id="floater">
            <div id="wrapper">
                <form action="/anonymous/sign-in.json" method="POST">
                    <h2>Logstown.com</h2>
                    <div id="feedback"></div>
                    <label for="email">Email</label>
                    <input class="start-here text" id="email" 
                        name="email" tabindex="1" />
                    
                    <label for="password">Password <i>(6+ characters)</i></label>
                    <input type="password" name="password" 
                        id="password" class="text" tabindex="2" />

                    <div id="confirm-box">
                        <label for="confirm">Confirm Password</label>
                        <input type="password" name="confirm"
                            id="confirm" class="text" tabindex="3" />
                    </div>

                    <div id="submit-button"> 
                        <a id="other" href="" tabindex="5" >Register</a>
                        <input type="submit" class="submit button darkgreen" 
                            id="submit" value="Sign In" tabindex="4" />
                    </div>
                </form>
                <div id="footer">
                    &copy; 2011 Logstown.com
                </div>
            </div>
        </div>
    </body>
</html>
