from gittip import db
from aspen import Response
SQL = "SELECT username, id FROM participants " \
      "WHERE username LIKE %s ORDER BY username"
^L

error = ''
if 'query' not in qs:
    error = "no 'query' key in querystring"
else:
    query = qs['query']
    if len(query) < 2:
        error = "query must be at least two characters"

if error:
    response.code = 400
    response.body = {"error": error}
else:
    response.body = [(r['username'], r['id']) \
                                     for r in db.fetchall(SQL, (query + '%',))]
