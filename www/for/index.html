from gittip.models import community
from gittip.utils import plural

# ========================== ^L

communities = community.get_list_for(None)
ncommunities = len(communities)

viable = []
forming = []

for community in communities:
    if community['nmembers'] >= website.NMEMBERS_THRESHOLD:
        seq = viable
    else:
        seq = forming
    seq.append(community)

grouped = [ ('Viable Communities', viable)
          , ('Communities in Formation', forming)
           ]

# ========================== ^L
{% extends templates/base.html %}
{% block heading %}
<h2 class="top"><span>Communities</span></h2>
{% end %}
{% block box %}
<div class="on-community">
    <h2 class="pad-sign">There are</h2>
    <div class="number">
        <span class="total-giving">{{ ncommunities }}</span>
    </div>
    <div class="unit pad-sign">
        communit{{ plural(ncommunities, 'y', 'ies') }} on Gittip.
    </div>
</div>
{% end %}
{% block page %}
<div class="col0">
    {% for heading, seq in grouped %}
    <h2>{{ heading }} (N = {{ len(seq) }})</h2>
    <ul class="community-memberships">
        {% for community in seq %}
        <li>
            <a href="/for/{{ community['slug'] }}/">{{ community['name'] }}</a>
            {% set n = community['nmembers'] %}
            <div class="fine">{{ n }} member{{ plural(n) }}</div>
        </li>
        {% end %}
    </ul>
    {% end %}
</div>
{% end %}
