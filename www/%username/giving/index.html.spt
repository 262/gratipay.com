from aspen import Response
from gittip.utils import get_participant, parse_locale, _

[-----------------------------------------------------------------------------]

loc = parse_locale(request)
participant = get_participant(request, restrict=True)
tips, total, unclaimed_tips, unclaimed_total = \
                                           participant.get_giving_for_profile()
hero = _("Giving", loc)
title = "%s - %s" % (participant.username, hero)
locked = False
first_time = qs.get('first_time') == '1'

[-----------------------------------------------------------------------------]
{% extends "templates/profile.html" %}
{% block page %}
<style>
    #matrix td {
        text-align: left;
        height: 30px;
    }
    #matrix h2,
    #matrix tr.tip td,
    #matrix tr.tip th,
    #matrix tr.pledge td,
    #matrix tr.pledge th {
        white-space: nowrap;
    }
    #matrix th {
        vertical-align: middle;
        padding-right: 0.5em;
    }
</style>
<table id="matrix" class="col0">
    <tr>
        <td colspan="2">
            {% if first_time %}

            <h2>{{ _("Thanks for joining Gittip!", loc) }}</h2>

            <p>{{ _("To get you started, we've suggested a few people to give to below. Next steps:", loc) }}</p>

            <ol>
                <li>{{ _("Change the weekly tips below as you please.", loc) }}</li>
                <li>{{ _("{0}Add a credit card{1} to make sure your weekly tips go through this Thursday.", loc).format(
                        "<a class='highlight' href='/credit-card.html'>", "</a>") }}</li>
                <li>{{ _("{0}Fill out your profile{1} to let others know about you.", loc).format(
                        "<a href='../'>", "</a>") }}</li>
            </ol>

            {% endif %}
            {% if participant == user.participant %}
            <h2>{{ _("You give {0} per week", loc).format(
                "<span class='my-total-giving'>$" + str(total) + "</span>") }}</h2>
            {% else %}
            <h2>{{ _("{0} gives {1} per week", loc).format(
                participant.username, "$" + str(total)) }}</h2>
            {% endif %}
        </td>
    </tr>
    {% for tip in tips %}
    {% set my_tip = tip.amount %}
    {% set tippee = tip.tippee %}
    {% if my_tip > 0 %}
    <tr class="tip">
        <th><a href="/{{ tippee }}/">{{ tippee }}</a></th>
        <td>{% include "templates/my-tip-bulk.html" %}</td>
    </tr>
    {% endif %}
    {% endfor %}
    {% if unclaimed_total > 0 %}
    <tr>
        <td colspan="2">
            <h2>{{ _("Another {0} per week goes unclaimed", loc).format(
                "$" + str(unclaimed_total)) }}</h2>
        </td>
    </tr>
    {% endif %}
    {% for tip in unclaimed_tips %}
    {% set my_tip = tip.amount %}
    {% set tippee = tip.tippee %}
    {% if my_tip > 0 %}
    <tr class="pledge">
        <th>
            <img class="platform-icon" src="{{ website.asset_url }}/icons/{{ tip.platform }}.12.png" />
            <a href="/{{ tippee }}/">{{ tip.user_name }}</a>
        </th>
        <td>{% include "templates/my-tip-bulk.html" %}</td>
    </tr>
    {% endif %}
    {% endfor %}
</table>
{% endblock %}
